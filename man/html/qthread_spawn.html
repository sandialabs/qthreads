<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>qthread_spawn(3) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
<b>qthread_spawn</b> - spawn a qthread (task) 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>#include &lt;qthread.h&gt;</b> 
<p> <i>int</i>
<br>
<b>qthread_spawn</b> (qthread_f             <i>f</i>,<i></i> <br>
 const void           *<i>arg</i>,<i></i> <br>
 size_t                <i>arg_size</i>,<i></i> <br>
 void                 *<i>ret</i>,<i></i> <br>
 size_t                <i>npreconds</i>,<i></i> <br>
 void                 *<i>preconds</i>,<i></i> <br>
 qthread_shepherd_id_t <i>target_shep</i>,<i></i> <br>
 unsigned int          <i>feature_flags</i>);<i></i> 
<p> 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
This is the master function
for generating and scheduling new tasks. All other functions that spawn
tasks, particularly those beginning with the string "qthread_fork", are
fundamentally convenience wrapper functions around this function. <p>
The first
argument, <i>f</i>, is a function that will be run to completion as the created
task. The qthread_f function must have a prototype like this: <blockquote><p>
aligned_t
function(void *arg); </blockquote>
<p>
The second argument, <i>arg</i>, is an argument for the function.
The treatment of this pointer depends on the value of the third argument,
<i>arg_size</i>. If <i>arg_size</i> is zero, the pointer will be passed to the function
<i>f</i> unchanged. However, if <i>arg_size</i> is non-zero, then <i>arg_size</i> bytes will be
copied from <i>arg</i> and stored in task-specific memory. This memory is usually
pre-allocated (unless <i>arg_size</i> is very large), so the performance is limited
primarily by the speed of <b>memcpy</b>(). When <i>f</i> is called, a pointer to the copy
will be passed as the argument to <i>f</i> instead of the original value of <i>arg</i>.
<p>
The fourth argument, <i>ret</i>, is a pointer indicating where to store the return
value of <i>f</i>. This location may be an aligned_t, a syncvar_t, or a qt_sinc_t,
and the type is indicated with flags passed in the <i>feature_flags</i> argument.
The location may also be NULL. If the type is an aligned_t, the return value
location is emptied by <b>qthread_spawn</b>() and is stored by calling <b>qthread_writeF</b>()
when the task returns. If the type is a syncvar_t, the return value location
is emptied by <b>qthread_spawn</b>() and is stored by calling <b>qthread_syncvar_writeF</b>()
when the task returns. If the type is a qt_sinc_t, when the task returns,
the function <b>qt_sinc_submit</b>() is called on the sinc. If so configured (by
passing the flag <b>QTHREAD_SPAWN_RET_SINC_VOID</b> to the <i>feature_flag</i> argument),
return value is submitted to the sinc. <p>
The fifth and sixth arguments, <i>npreconds</i>
and <i>preconds</i>, are for creating "preconditioned" tasks, also sometimes referred
to as "data-dependent" tasks or "triggered" tasks. The <i>preconds</i> argument
is expected to be an array of <i>npreconds</i> pointers either to aligned_t&rsquo;s or
syncvar_t&rsquo;s (depending on the flags passed to the <i>feature_flag</i> argument).
The task will be scheduled only when all of the preconditions have been
in the relevant "full" state at least once. The preconditions are queried
in an undefined order, so preconditions that can return to the empty state
before the task is spawned create undefined behavior. <p>
The seventh argument,
<i>target_shep</i>, specifies a destination shepherd for the task. The task will
only ever execute on the specified shepherd unless that shepherd is disabled.
If the task should be able to execute anywhere, use the pre-defined constant
NO_SHEPHERD to specify the lack of preference. <p>
The eighth argument, <i>feature_flag</i>,
is a way of passing additional flags to control task behavior. The available
flags are as follows: 
<dl>

<dt>QTHREAD_SPAWN_SIMPLE </dt>
<dd>This flag specifies that the
task spawned will not block. Violations of this promise will cause the program
to abort. In exchange for making this promise, the runtime can avoid a great
deal of context-swap overhead and can provide the task with much more stack
space for "free" (it uses the worker thread&rsquo;s stack). </dd>

<dt>QTHREAD_SPAWN_NEW_TEAM
</dt>
<dd>Tasks are, by default, spawned into their parent&rsquo;s team. This flag specifies
that the spawned task will be the founding member of a new task team and
not a member of the calling task&rsquo;s team. Task teams are collections of tasks.
Any task that performs a readFF() operation on the return value location
of a task that is the founding member of a task team will not be unblocked
until all of the tasks in that team also return. </dd>

<dt>QTHREAD_SPAWN_NEW_SUBTEAM
</dt>
<dd>This flag specifies that the spawned task will be the founding member of
a new task team that is dependent upon the calling task&rsquo;s team, but not
a member of the calling task&rsquo;s team. </dd>

<dt>QTHREAD_SPAWN_RET_SYNCVAR_T </dt>
<dd>This flag
specifies that the return value location, <i>ret</i>, points to a syncvar_t. This
flag conflicts with other QTHREAD_SPAWN_RET_* flags. If no QTHREAD_SPAWN_RET_*
flags are specified, the return value location is assumed to point to an
aligned_t. </dd>

<dt>QTHREAD_SPAWN_RET_SINC </dt>
<dd>This flag specifies that the return value
location, <i>ret</i>, points to a qt_sinc_t, and that the return value itself
should be submitted to the sinc. This flag conflicts with other QTHREAD_SPAWN_RET_*
flags. If no QTHREAD_SPAWN_RET_* flags are specified, the return value location
is assumed to point to an aligned_t. </dd>

<dt>QTHREAD_SPAWN_RET_SINC_VOID </dt>
<dd>This flag
specifies that the return value location, <i>ret</i>, points to a qt_sinc_t, and
that the return value itself should be ignored. This flag conflicts with
other QTHREAD_SPAWN_RET_* flags. If no QTHREAD_SPAWN_RET_* flags are specified,
the return value location is assumed to point to an aligned_t. </dd>

<dt>QTHREAD_SPAWN_PC_SYNCVAR_T
</dt>
<dd>This flag specifies that the precondition array, <i>preconds</i>, is an array
of pointers to syncvar_t&rsquo;s, rather than aligned_t&rsquo;s. 
<p> </dd>
</dl>

<h2><a name='sect3' href='#toc3'>Spawn Cache</a></h2>
Tasks are
normally spawned into a thread-local cache of tasks. The contents of this
cache are not visible to other tasks until the next scheduling event, at
which point the cache is flushed into the local shepherd&rsquo;s globally visible
scheduling queue. Scheduling events are times when the scheduling queue
must be checked, namely, when the current task either blocks or yields.
This cache can be disabled at configure time, in which case, tasks are
pushed into the globally visible scheduling queue as they are spawned. 
<p>

<h2><a name='sect4' href='#toc4'>Environment</a></h2>
The operation of these functions is modified by the following
environment variables: 
<dl>

<dt><b>QTHREAD_STACK_SIZE</b> </dt>
<dd>This variable specifies, in bytes,
the size of the stacks that will be created for each thread. Changes to
this value during the course of the program run are ignored; the value
is only evaluated when <b>qthread_initialize</b>() is run. </dd>
</dl>

<h2><a name='sect5' href='#toc5'>Return Value</a></h2>
On success,
the thread is spawned and 0 is returned. On error, a non-zero error code
is returned. 
<h2><a name='sect6' href='#toc6'>Errors</a></h2>

<dl>

<dt><b>ENOMEM</b> </dt>
<dd>Not enough memory was available to spawn a task.
</dd>
</dl>

<h2><a name='sect7' href='#toc7'>See Also</a></h2>
<a href='qthread_fork.html'><b>qthread_fork</b>(3)</a>
, <a href='qthread_migrate_to.html'><b>qthread_migrate_to</b>(3)</a>
 <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Spawn Cache</a></li>
<li><a name='toc4' href='#sect4'>Environment</a></li>
<li><a name='toc5' href='#sect5'>Return Value</a></li>
<li><a name='toc6' href='#sect6'>Errors</a></li>
<li><a name='toc7' href='#sect7'>See Also</a></li>
</ul>
</body>
</html>
