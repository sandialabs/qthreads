<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>qthread_init(3) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
<b>qthread_init</b>, <b>qthread_initialize</b> - initialize the qthread library 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>#include
&lt;qthread.h&gt;</b> 
<p> <i>int</i> <br>
<b>qthread_init</b> (qthread_shepherd_id_t <i>nshepherds</i>);<i></i> <p>
<i>int</i> <br>
<b>qthread_initialize</b> (); 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
Use these functions to initialize the
qthreads environment before using any other qthread functions. The <b>qthread_init</b>()
function is deprecated in favor of <b>qthread_initialize</b>() which will attempt
to auto-detect the correct number of shepherds for the system. The number
of shepherds can be forcibly specified with the environment variable QTHREAD_NUM_SHEPHERDS.
The <b>qthread_init</b>() function is a wrapper around <b>qthread_initialize</b>() that
simply exports the QTHREAD_NUM_SHEPHERDS environment variable. If QTHREAD_NUM_SHEPHERDS
is 0 or unset, the library will attempt to guess the correct number of
shepherds, defaulting to a single shepherd if no information about the
system could be found. Shepherds will attempt to pin themselves to processors
using whatever CPU affinity libraries are available. 
<h2><a name='sect3' href='#toc3'>Environment</a></h2>
The operation
of <b>qthread_init</b>() is modified by several environment variables. All environment
variables may begin with either QTHREAD_ or QT_; they are treated the same
by Qthreads. The following environment variables may be considered (not
all apply to all environments): 
<dl>

<dt>QTHREAD_INFO </dt>
<dd>This variable controls what
kind of status information is printed during initialization. If this variable
is set to "1", Qthreads will print the number of shepherds, the number
of workers per shepherd, and the stack size of each qthread to stdout. If
this variable is set to "2", Qthreads will additionally print the name
and value of every environment variable that it checks. </dd>

<dt>QTHREAD_AFFINITY
</dt>
<dd>If this variable is set to "no", then the shepherds will not pin themselves
to specific locations. </dd>

<dt>QTHREAD_DEBUG_LEVEL </dt>
<dd>This variable is used to control
the verbosity of debug messages that get printed at runtime. Higher numbers
increase the verbosity; a value of 0 is the same as being unset, which
prevents debug messages from being printed. This is only applicable if debugging
has been enabled when the library was built. </dd>

<dt>QTHREAD_STACK_SIZE </dt>
<dd>This variable
specifies, in bytes, the size of the stacks that will be created for each
thread. Changes to this value during the course of the program run are ignored;
the value is only considered when <b>qthread_init</b>() is run. </dd>

<dt>QTHREAD_NUM_SHEPHERDS
</dt>
<dd>This variable specifies how many shepherds to create. </dd>

<dt>QTHREAD_NUM_WORKERS_PER_SHEPHERD
</dt>
<dd>This variable specifies how many worker threads to assign to each shepherd.
This setting is ignored by some schedulers that only allow one worker per
shepherd. </dd>

<dt>QTHREAD_HWPAR </dt>
<dd>This variable specifies how much hardware parallelism
to use. It allows the number of shepherds and worker threads per shepherd
to be chosen according to the machine topology while only specifying how
many may be running. If this number does not divide evenly among the appropriate
number of shepherds, extra workers will be created but will begin in a
disabled state. </dd>

<dt>QTHREAD_ARGCOPY_SIZE </dt>
<dd>This variable controls the amount of
memory preallocated for storing argument data per task. Not all tasks have
memory preallocated for argument data, but when they do, the amount is
controlled by this environment variable. </dd>

<dt>QTHREAD_TASKLOCAL_SIZE </dt>
<dd>This variable
is similar to the previous variable, but instead of argument data, it controls
the size of the preallocated per-task scratchpad. </dd>

<dt>QTHREAD_STEAL_CHUNK </dt>
<dd>This
variable applies to certain work-stealing schedulers (such as the default
Sherwood scheduler) and controls the number of tasks stolen during load-balancing
operations. By default, or when this variable is set to zero, half of the
victim&rsquo;s work is stolen. Otherwise, thief workers will attempt to steal at
most this many tasks. </dd>

<dt>QTHREAD_MAX_IO_WORKERS </dt>
<dd>This variable controls the
maximum number of threads that can be spawned to service the I/O subsystem&rsquo;s
queue. In effect, it limits the amount of OS overhead that the I/O subsystem
can consume. </dd>

<dt>QTHREAD_IO_TIMEOUT </dt>
<dd>This variable controls how long each I/O
subsystem thread will wait for additional work before exiting. </dd>

<dt>QTHREAD_SHEPHERD_BOUNDARY
</dt>
<dd>This variable is used to control shepherd affinity. Essentially, it sets
the physical boundary that the shepherd will represent. Currently only used
when using the hwloc library. Valid values are: node, cache, socket, core,
pu, L1cache, L2cache, L3cache, and L4cache. </dd>

<dt>QTHREAD_WORKER_UNIT </dt>
<dd>This variable
is used to control worker thread affinity; essentially it controls worker
spacing. For example, one could force a single shepherd to cover a whole
node with the QTHREAD_SHEPHERD_BOUNDARY, and then use this variable to
put one worker on each socket. The valid values are the same as for QTHREAD_SHEPHERD_BOUNDARY,
but this one MUST be lower in the topology hierarchy than the shepherd
boundary. The default is "pu". </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Return Value</a></h2>
On success, the system is ready
to fork threads and 0 is returned. On error, an non-zero error code is returned.

<h2><a name='sect5' href='#toc5'>Errors</a></h2>

<dl>

<dt><b>ENOMEM</b> </dt>
<dd>Not enough memory could be allocated. </dd>
</dl>

<h2><a name='sect6' href='#toc6'>See Also</a></h2>
<a href='qthread_finalize.html'><b>qthread_finalize</b>(3)</a>

 <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Environment</a></li>
<li><a name='toc4' href='#sect4'>Return Value</a></li>
<li><a name='toc5' href='#sect5'>Errors</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
</ul>
</body>
</html>
